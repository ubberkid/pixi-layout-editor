var de=Object.defineProperty;var pe=(s,e,t)=>e in s?de(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var u=(s,e,t)=>pe(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class he{constructor(){u(this,"_channel",null);u(this,"_handlers",new Map);u(this,"_onStatusChange",null);u(this,"_connected",!1)}get isConnected(){return this._connected}onStatusChange(e){this._onStatusChange=e}on(e,t){this._handlers.has(e)||this._handlers.set(e,[]),this._handlers.get(e).push(t)}connect(){this._channel&&this._channel.close(),this._channel=new BroadcastChannel("layout-editor"),this._channel.onmessage=e=>{var o;this._connected||(this._connected=!0,(o=this._onStatusChange)==null||o.call(this,!0));const t=e.data,a=this._handlers.get(t.type);a&&a.forEach(n=>n(t))},this.send({type:"get-hierarchy"}),setTimeout(()=>{this._connected||console.log("No response from game - make sure you are in the BingoGameScene")},1e3)}disconnect(){var e,t;(e=this._channel)==null||e.close(),this._channel=null,this._connected=!1,(t=this._onStatusChange)==null||t.call(this,!1)}send(e){var t;(t=this._channel)==null||t.postMessage(e)}}const v=new he;class ge{constructor(e){u(this,"_container");u(this,"_hierarchy",[]);u(this,"_selectedId",null);u(this,"_expandedIds",new Set);u(this,"_changedNodeIds",new Set);u(this,"_onSelect",null);u(this,"_onHover",null);this._container=document.getElementById(e)}onSelect(e){this._onSelect=e}onHover(e){this._onHover=e}setChangedNodes(e){this._changedNodeIds=e,this.render()}getSelectedId(){return this._selectedId}setHierarchy(e){this._hierarchy=e,e.forEach(t=>this._expandedIds.add(t.id)),this.render()}getNodeById(e){const t=a=>{for(const o of a){if(o.id===e)return o;const n=t(o.children);if(n)return n}return null};return t(this._hierarchy)}updateNode(e,t){const a=this.getNodeById(e);a&&(Object.assign(a,t),this.render())}selectNodeById(e){this._selectedId=e,this.render()}render(){this._container.innerHTML="",this._hierarchy.forEach(e=>{this._container.appendChild(this.renderNode(e))})}renderNode(e){const t=document.createElement("div");t.className="tree-node";const a=e.layout&&Object.keys(e.layout).length>0,o=e.layoutEnabled!==!1,n=document.createElement("div");n.className="tree-node-header",e.id===this._selectedId&&n.classList.add("selected"),o?a||n.classList.add("tree-node-no-layout"):n.classList.add("tree-node-disabled");const l=document.createElement("span");l.className="tree-node-toggle",e.children.length>0&&(l.textContent=this._expandedIds.has(e.id)?"▼":"▶",l.addEventListener("click",i=>{i.stopPropagation(),this.toggleExpand(e.id)}));const d=document.createElement("span");if(d.className="tree-node-label",d.textContent=e.id||`[${e.type}]`,this._changedNodeIds.has(e.id)){const i=document.createElement("span");i.className="tree-node-change-dot",i.title="Has unsaved changes",d.appendChild(i)}if(o){if(a){const i=document.createElement("span");i.className="tree-node-badge",i.textContent="L",i.title="Has layout properties",d.appendChild(i)}}else{const i=document.createElement("span");i.className="tree-node-badge disabled",i.textContent="✗",i.title="Layout disabled",d.appendChild(i)}if(n.appendChild(l),n.appendChild(d),n.addEventListener("click",()=>{this.selectNode(e.id)}),n.addEventListener("mouseenter",()=>{var i;(i=this._onHover)==null||i.call(this,e.id)}),n.addEventListener("mouseleave",()=>{var i;(i=this._onHover)==null||i.call(this,null)}),t.appendChild(n),e.children.length>0){const i=document.createElement("div");i.className="tree-node-children",this._expandedIds.has(e.id)||i.classList.add("collapsed"),e.children.forEach(m=>{i.appendChild(this.renderNode(m))}),t.appendChild(i)}return t}toggleExpand(e){this._expandedIds.has(e)?this._expandedIds.delete(e):this._expandedIds.add(e),this.render()}selectNode(e){var a;this._selectedId=e,this.render();const t=this.getNodeById(e);(a=this._onSelect)==null||a.call(this,t)}}const ue=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","anchorX","anchorY","alpha"];function U(s){return ue.includes(s)}const me=[{title:"Transform",isTransform:!0,properties:[{key:"x",type:"number",label:"x",desc:`Horizontal position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"y",type:"number",label:"y",desc:`Vertical position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"scaleX",type:"number",label:"scale.x",step:.1,desc:`Horizontal scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"scaleY",type:"number",label:"scale.y",step:.1,desc:`Vertical scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"rotation",type:"number",label:"rotation",step:.1,desc:`Rotation in radians around the pivot point.
Examples: 0, 1.57 (90°), 3.14 (180°), 6.28 (360°)`},{key:"pivotX",type:"number",label:"pivot.x",desc:`X origin for rotation/scale in local pixels.
Examples: 0 (left), width/2 (center)`},{key:"pivotY",type:"number",label:"pivot.y",desc:`Y origin for rotation/scale in local pixels.
Examples: 0 (top), height/2 (center)`},{key:"anchorX",type:"number",label:"anchor.x",step:.1,desc:`X anchor as fraction of texture (Sprites only).
Examples: 0 (left), 0.5 (center), 1 (right)`},{key:"anchorY",type:"number",label:"anchor.y",step:.1,desc:`Y anchor as fraction of texture (Sprites only).
Examples: 0 (top), 0.5 (center), 1 (bottom)`},{key:"alpha",type:"number",label:"alpha",step:.1,desc:`Opacity from 0 (invisible) to 1 (fully visible).
Examples: 1, 0.5 (semi-transparent), 0`}]},{title:"Size",properties:[{key:"width",type:"text",label:"width",desc:`Container width. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"height",type:"text",label:"height",desc:`Container height. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"minWidth",type:"number",label:"minWidth",desc:`Minimum width constraint in pixels.
Examples: 100, 200`},{key:"maxWidth",type:"number",label:"maxWidth",desc:`Maximum width constraint in pixels.
Examples: 500, 1000`},{key:"minHeight",type:"number",label:"minHeight",desc:`Minimum height constraint in pixels.
Examples: 100, 200`},{key:"maxHeight",type:"number",label:"maxHeight",desc:`Maximum height constraint in pixels.
Examples: 500, 1000`}]},{title:"Flexbox Container",properties:[{key:"flexDirection",type:"select",label:"flexDirection",desc:`Main axis direction for laying out children.
• row: left to right
• column: top to bottom
• row-reverse: right to left
• column-reverse: bottom to top`,options:["row","column","row-reverse","column-reverse"]},{key:"flexWrap",type:"select",label:"flexWrap",desc:`Whether children wrap to new lines.
• nowrap: single line, may overflow
• wrap: wrap to next line
• wrap-reverse: wrap upward/leftward`,options:["nowrap","wrap","wrap-reverse"]},{key:"justifyContent",type:"select",label:"justifyContent",desc:`Align children along the main axis.
• flex-start: pack at start
• flex-end: pack at end
• center: center items
• space-between: equal space between
• space-around: equal space around
• space-evenly: equal space everywhere`,options:["flex-start","flex-end","center","space-between","space-around","space-evenly"]},{key:"alignItems",type:"select",label:"alignItems",desc:`Align children along the cross axis.
• flex-start: align to start
• flex-end: align to end
• center: center items
• stretch: stretch to fill
• baseline: align text baselines`,options:["flex-start","flex-end","center","stretch","baseline"]},{key:"alignContent",type:"select",label:"alignContent",desc:`Align wrapped lines (only with flexWrap).
• flex-start: pack lines at start
• flex-end: pack lines at end
• center: center lines
• stretch: stretch lines to fill
• space-between: equal space between lines
• space-around: equal space around lines`,options:["flex-start","flex-end","center","stretch","space-between","space-around"]},{key:"gap",type:"number",label:"gap",desc:`Space between all children in pixels.
Examples: 0, 10, 20`},{key:"rowGap",type:"number",label:"rowGap",desc:`Space between rows in pixels (overrides gap for rows).
Examples: 0, 10, 20`},{key:"columnGap",type:"number",label:"columnGap",desc:`Space between columns in pixels (overrides gap for columns).
Examples: 0, 10, 20`}]},{title:"Flexbox Item",properties:[{key:"flex",type:"number",label:"flex",desc:`Shorthand for flex-grow. How much this item grows relative to siblings.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexGrow",type:"number",label:"flexGrow",desc:`How much this item grows to fill extra space.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexShrink",type:"number",label:"flexShrink",desc:`How much this item shrinks when space is tight.
Examples: 0 (don't shrink), 1 (shrink equally)`},{key:"flexBasis",type:"number",label:"flexBasis",desc:`Initial size before growing/shrinking, in pixels.
Examples: 0, 100, 200`},{key:"alignSelf",type:"select",label:"alignSelf",desc:`Override parent's alignItems for this item.
• auto: use parent's alignItems
• flex-start/end/center/stretch/baseline: same as alignItems`,options:["auto","flex-start","flex-end","center","stretch","baseline"]}]},{title:"Spacing",properties:[{key:"padding",type:"number",label:"padding",desc:`Inner spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"paddingTop",type:"number",label:"paddingTop",desc:`Inner spacing at top in pixels.
Examples: 0, 10, 20`},{key:"paddingRight",type:"number",label:"paddingRight",desc:`Inner spacing at right in pixels.
Examples: 0, 10, 20`},{key:"paddingBottom",type:"number",label:"paddingBottom",desc:`Inner spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"paddingLeft",type:"number",label:"paddingLeft",desc:`Inner spacing at left in pixels.
Examples: 0, 10, 20`},{key:"margin",type:"number",label:"margin",desc:`Outer spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"marginTop",type:"number",label:"marginTop",desc:`Outer spacing at top in pixels.
Examples: 0, 10, 20`},{key:"marginRight",type:"number",label:"marginRight",desc:`Outer spacing at right in pixels.
Examples: 0, 10, 20`},{key:"marginBottom",type:"number",label:"marginBottom",desc:`Outer spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"marginLeft",type:"number",label:"marginLeft",desc:`Outer spacing at left in pixels.
Examples: 0, 10, 20`}]}],G="layout-editor-sessions",X="layout-editor-current-session";class ye{constructor(e,t){u(this,"_formContainer");u(this,"_noSelectionEl");u(this,"_selectedNode",null);u(this,"_liveOriginals",new Map);u(this,"_sessionChanges",new Map);u(this,"_hasUnsavedChanges",!1);u(this,"_onChange",null);u(this,"_onCopy",null);u(this,"_onChangesUpdated",null);u(this,"_onReset",null);this._formContainer=document.getElementById(e),this._noSelectionEl=document.getElementById(t),localStorage.removeItem("layout-editor-changes"),localStorage.removeItem("layout-editor-originals"),localStorage.removeItem("layout-editor-transforms")}captureOriginals(e){this._liveOriginals.clear();const t=a=>{this._liveOriginals.set(a.id,{layout:a.layout?{...a.layout}:{},transform:a.transform?{...a.transform}:{},layoutEnabled:a.layoutEnabled}),a.children.forEach(t)};e.forEach(t),console.log(`[PropertyPanel] Captured originals for ${this._liveOriginals.size} nodes`)}clearOriginals(){this._liveOriginals.clear()}getOriginalValue(e,t,a){const o=this._liveOriginals.get(e);if(o)return t==="_layoutEnabled"?o.layoutEnabled:a?o.transform[t]:o.layout[t]}getSessionChanges(){return this._sessionChanges}hasUnsavedChanges(){return this._hasUnsavedChanges}hasOriginals(){return this._liveOriginals.size>0}clearCurrentSession(){localStorage.removeItem(X)}getSessions(){try{const e=localStorage.getItem(G);return e?JSON.parse(e):[]}catch{return[]}}saveSession(e){try{const t={};for(const[n,l]of this._sessionChanges){const d={},i=this._liveOriginals.get(n);for(const[m,N]of Object.entries(l)){let E;if(m==="_layoutEnabled")E=i==null?void 0:i.layoutEnabled;else{const f=U(m);E=i?f?i.transform[m]:i.layout[m]:void 0}N!==E&&(d[m]=N)}Object.keys(d).length>0&&(t[n]=d)}const a={changes:t};localStorage.setItem(`layout-editor-session-${e}`,JSON.stringify(a));const o=this.getSessions();o.includes(e)||(o.push(e),localStorage.setItem(G,JSON.stringify(o))),localStorage.setItem(X,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Saved session: ${e} (${Object.keys(t).length} nodes)`)}catch(t){console.warn("[PropertyPanel] Failed to save session:",t)}}loadSession(e){var t;try{const a=localStorage.getItem(`layout-editor-session-${e}`);if(!a)return null;const o=JSON.parse(a);this._sessionChanges.clear();let n=0;for(const[l,d]of Object.entries(o.changes)){const i={},m=this._liveOriginals.get(l);for(const[N,E]of Object.entries(d)){let f;if(N==="_layoutEnabled")f=m==null?void 0:m.layoutEnabled;else{const A=U(N);f=m?A?m.transform[N]:m.layout[N]:void 0}E!==f?i[N]=E:n++}Object.keys(i).length>0&&this._sessionChanges.set(l,i)}return localStorage.setItem(X,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Loaded session: ${e} (skipped ${n} matching values)`),(t=this._onChangesUpdated)==null||t.call(this),this.render(),{changes:this._sessionChanges,skipped:n}}catch(a){return console.warn("[PropertyPanel] Failed to load session:",a),null}}deleteSession(e){try{localStorage.removeItem(`layout-editor-session-${e}`);const t=this.getSessions().filter(a=>a!==e);localStorage.setItem(G,JSON.stringify(t)),console.log(`[PropertyPanel] Deleted session: ${e}`)}catch(t){console.warn("[PropertyPanel] Failed to delete session:",t)}}getCurrentSessionName(){return localStorage.getItem(X)}onChange(e){this._onChange=e}onCopy(e){this._onCopy=e}onChangesUpdated(e){this._onChangesUpdated=e}onReset(e){this._onReset=e}getAllResetValues(){const e=new Map;for(const[t,a]of this._sessionChanges){const o=this._liveOriginals.get(t);if(!o)continue;const n={};for(const l of Object.keys(a))if(l==="_layoutEnabled")n[l]=o.layoutEnabled;else{const d=U(l);n[l]=d?o.transform[l]:o.layout[l]}Object.keys(n).length>0&&e.set(t,n)}return e}resetNode(e){var n,l;const t=this._liveOriginals.get(e);if(!t)return;const a=this._sessionChanges.get(e);if(!a)return;const o={};for(const d of Object.keys(a))if(d==="_layoutEnabled")o[d]=t.layoutEnabled;else{const i=U(d);o[d]=i?t.transform[d]:t.layout[d]}this._sessionChanges.delete(e),this._hasUnsavedChanges=!0,(n=this._onReset)==null||n.call(this,e,o),(l=this._onChangesUpdated)==null||l.call(this),this.render()}getChangedNodeIds(){return new Set(this._sessionChanges.keys())}setSelectedNode(e){this._selectedNode=e,this.render()}updateNodeLayout(e,t,a,o){var n;if(((n=this._selectedNode)==null?void 0:n.id)===e&&(this._selectedNode.layout=t,a&&(this._selectedNode.transform=a),o!==void 0)){const l=this._selectedNode.layoutEnabled!==o;this._selectedNode.layoutEnabled=o,l&&this.render()}}render(){var ne,se,oe;if(!this._selectedNode){this._formContainer.style.display="none",this._noSelectionEl.style.display="block";return}this._noSelectionEl.style.display="none",this._formContainer.style.display="block",this._formContainer.innerHTML="";const e=document.createElement("div");e.id="selected-name-row";const t=document.createElement("div");if(t.id="selected-name",t.textContent=this._selectedNode.id,e.appendChild(t),this._sessionChanges.has(this._selectedNode.id)){const g=document.createElement("button");g.id="reset-node-btn",g.textContent="Reset",g.title="Reset all changes for this node",g.addEventListener("click",()=>{this.resetNode(this._selectedNode.id)}),e.appendChild(g)}this._formContainer.appendChild(e);const a=document.createElement("div");a.className="property-row toggle-row";const o=document.createElement("label");o.className="property-label",o.textContent="Layout Enabled";const n=this._selectedNode.id,l=this._liveOriginals.get(n),d=this._sessionChanges.get(n)||{},i=(l==null?void 0:l.layoutEnabled)??!1,m=d._layoutEnabled,N=m!==void 0?m:this._selectedNode.layoutEnabled,E=document.createElement("input");E.type="checkbox",E.checked=N;const f=document.createElement("span");f.className="property-original";const A=()=>{E.checked!==i?(f.textContent=`was: ${i?"on":"off"}`,f.style.display="inline",f.title="Click to reset"):f.style.display="none"};A(),f.setAttribute("role","button"),f.setAttribute("tabindex","0");const Q=()=>{E.checked=i,A(),Z(i)};f.addEventListener("click",Q),f.addEventListener("keydown",g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),Q())});const Z=g=>{var R,h,L,I,r,O,b,B,C,T,p;this._sessionChanges.has(n)||this._sessionChanges.set(n,{});const S=this._sessionChanges.get(n);if(g!==i?(S._layoutEnabled=g,this._hasUnsavedChanges=!0):(delete S._layoutEnabled,Object.keys(S).length===0&&this._sessionChanges.delete(n)),(R=this._onChangesUpdated)==null||R.call(this),A(),g)(h=this._onChange)==null||h.call(this,n,"_layoutEnabled",!0);else{const _=((I=(L=this._selectedNode)==null?void 0:L.transform)==null?void 0:I.alpha)??1;(r=this._onChange)==null||r.call(this,n,"alpha",_+1e-4),(O=this._onChange)==null||O.call(this,n,"_layoutEnabled",!1);const y=this._liveOriginals.get(n);if(y!=null&&y.transform){const W=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","alpha"];for(const D of W){const j=y.transform[D];j!==void 0&&((b=this._onChange)==null||b.call(this,n,D,j))}(C=(B=this._selectedNode)==null?void 0:B.transform)!=null&&C.hasAnchor&&(y.transform.anchorX!==void 0&&((T=this._onChange)==null||T.call(this,n,"anchorX",y.transform.anchorX)),y.transform.anchorY!==void 0&&((p=this._onChange)==null||p.call(this,n,"anchorY",y.transform.anchorY)))}}};E.addEventListener("change",()=>{Z(E.checked)}),a.appendChild(o),a.appendChild(E),a.appendChild(f),this._formContainer.appendChild(a);const P=this._liveOriginals.get(this._selectedNode.id),ee=(P==null?void 0:P.layout)||{},te=(P==null?void 0:P.transform)||{},ce=this._sessionChanges.get(this._selectedNode.id)||{};for(const g of me){const S=document.createElement("div");S.className="property-section";const R=document.createElement("div");R.className="property-section-title",R.textContent=g.title,S.appendChild(R);for(const h of g.properties){if((h.key==="anchorX"||h.key==="anchorY")&&!((ne=this._selectedNode.transform)!=null&&ne.hasAnchor))continue;const L=document.createElement("div");L.className="property-row";const I=document.createElement("label");I.className="property-label",I.textContent=h.label,I.title=h.desc;let r;if(h.type==="select"){r=document.createElement("select"),r.className="property-input";const p=document.createElement("option");p.value="",p.textContent="(not set)",r.appendChild(p),h.options.forEach(_=>{const y=document.createElement("option");y.value=_,y.textContent=_,r.appendChild(y)})}else r=document.createElement("input"),r.className="property-input",r.type=h.type==="number"?"number":"text",h.step!==void 0&&(r.step=String(h.step));let O,b;const B=ce[h.key];if(g.isTransform){const p=h.key;O=B!==void 0?B:(se=this._selectedNode.transform)==null?void 0:se[p],b=te[h.key]}else O=B!==void 0?B:(oe=this._selectedNode.layout)==null?void 0:oe[h.key],b=ee[h.key];O!==void 0&&(r.value=String(O),r.classList.add("has-value")),r instanceof HTMLInputElement&&(r.placeholder="(not set)");const C=document.createElement("span");C.className="property-original";const T=()=>{const p=r.value===""?void 0:r.value,_=b!==void 0?String(b):void 0,y=p!==_;y&&b!==void 0?(C.textContent=`was: ${b}`,C.style.display="inline",C.title="Click to reset"):y&&b===void 0?(C.textContent="new",C.style.display="inline",C.title="Click to clear"):C.style.display="none"};T(),C.setAttribute("role","button"),C.setAttribute("tabindex","0"),C.addEventListener("click",()=>{var p;b!==void 0?r.value=String(b):r.value="",r.classList.toggle("has-value",r.value!==""),T(),(p=this._onChange)==null||p.call(this,this._selectedNode.id,h.key,b)}),C.addEventListener("keydown",p=>{var _;(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),b!==void 0?r.value=String(b):r.value="",r.classList.toggle("has-value",r.value!==""),T(),(_=this._onChange)==null||_.call(this,this._selectedNode.id,h.key,b))}),r.addEventListener("change",()=>{var D,j;r.classList.toggle("has-value",r.value!==""),T();let p=r.value;h.type==="number"&&p!==""&&(p=parseFloat(p)),p===""&&!g.isTransform&&(p=void 0);const _=this._selectedNode.id;this._sessionChanges.has(_)||this._sessionChanges.set(_,{});const y=this._sessionChanges.get(_),W=g.isTransform?te[h.key]:ee[h.key];p!==W?(y[h.key]=p,this._hasUnsavedChanges=!0):(delete y[h.key],Object.keys(y).length===0&&this._sessionChanges.delete(_)),(D=this._onChangesUpdated)==null||D.call(this),(j=this._onChange)==null||j.call(this,this._selectedNode.id,h.key,p)}),L.appendChild(I),L.appendChild(r),L.appendChild(C),S.appendChild(L)}this._formContainer.appendChild(S)}const $=document.createElement("button");$.id="copy-btn",$.textContent="Copy Layout",$.addEventListener("click",()=>{var g;(g=this._onCopy)==null||g.call(this,this._selectedNode.id)}),this._formContainer.appendChild($)}}const H=document.getElementById("connection-dropdown"),q=document.getElementById("connection-dropdown-btn"),z=document.getElementById("connection-dropdown-menu"),M=document.getElementById("session-dropdown"),V=document.getElementById("session-dropdown-btn"),ae=document.getElementById("session-list"),fe=document.getElementById("session-create"),ie=document.getElementById("view-changes-btn"),w=document.getElementById("changes-modal"),J=document.getElementById("changes-list"),be=document.getElementById("close-modal-btn"),Ce=document.getElementById("reset-all-btn");let x=null,K=!1;const k=new ge("tree-view"),c=new ye("property-form","no-selection"),Y=s=>{var e;if(s.size>0){console.log(`[Layout Editor] Applying ${s.size} node changes...`);for(const[t,a]of s)for(const[o,n]of Object.entries(a)){if(o==="_layoutEnabled"&&n===!1){const l=k.getNodeById(t),d=((e=l==null?void 0:l.transform)==null?void 0:e.alpha)??1;v.send({type:"set-property",id:t,property:"alpha",value:d+1e-4})}v.send({type:"set-property",id:t,property:o,value:n})}}},le=s=>{M.style.display=s?"block":"none",ie.style.display=s?"inline-block":"none"};k.onSelect(s=>{c.setSelectedNode(s),v.send({type:"highlight",id:(s==null?void 0:s.id)||null})});k.onHover(s=>{const e=s??k.getSelectedId();v.send({type:"highlight",id:e})});c.onChange((s,e,t)=>{v.send({type:"set-property",id:s,property:e,value:t}),x&&c.saveSession(x)});c.onChangesUpdated(()=>{k.setChangedNodes(c.getChangedNodeIds())});c.onCopy(s=>{v.send({type:"get-layout",id:s})});c.onReset((s,e)=>{var t;for(const[a,o]of Object.entries(e)){if(a==="_layoutEnabled"&&o===!1){const n=k.getNodeById(s),l=((t=n==null?void 0:n.transform)==null?void 0:t.alpha)??1;v.send({type:"set-property",id:s,property:"alpha",value:l+1e-4})}v.send({type:"set-property",id:s,property:a,value:o})}});const ve=()=>{J.innerHTML="";const s=c.getSessionChanges();if(s.size===0){J.innerHTML='<p style="color: #808080;">No changes</p>';return}for(const[e,t]of s){const a=document.createElement("div");a.className="change-node";const o=document.createElement("div");o.className="change-node-header",o.textContent=e,o.addEventListener("click",()=>{const n=k.getNodeById(e);n&&(c.setSelectedNode(n),k.selectNodeById(e)),w.style.display="none"}),a.appendChild(o);for(const[n,l]of Object.entries(t)){const d=U(n),i=c.getOriginalValue(e,n,d),m=document.createElement("div");m.className="change-item",m.innerHTML=`
        <span class="change-prop">${n}:</span>
        <span class="change-old">${i??"(not set)"}</span>
        <span class="change-arrow">→</span>
        <span class="change-new">${l??"(not set)"}</span>
      `,a.appendChild(m)}J.appendChild(a)}};ie.addEventListener("click",()=>{ve(),w.style.display="flex"});be.addEventListener("click",()=>{w.style.display="none"});w.addEventListener("click",s=>{s.target===w&&(w.style.display="none")});document.addEventListener("keydown",s=>{s.key==="Escape"&&w.style.display!=="none"&&(w.style.display="none")});Ce.addEventListener("click",()=>{if(confirm("Reset all changes?")){const s=c.getSessionChanges();for(const[e]of s)c.resetNode(e);w.style.display="none"}});const re=s=>{if(q.textContent=s?"Connected":"Disconnected",q.classList.toggle("connected",s),q.classList.toggle("disconnected",!s),z.innerHTML="",s){const e=document.createElement("div");e.className="dropdown-item",e.textContent="Refresh",e.addEventListener("click",()=>{const a=c.getAllResetValues();if(Y(a),x){const o=c.loadSession(x);o&&Y(o.changes)}else c.getSessionChanges().clear(),k.setChangedNodes(c.getChangedNodeIds());v.send({type:"get-hierarchy"}),H.classList.remove("open")});const t=document.createElement("div");t.className="dropdown-item",t.textContent="Disconnect",t.addEventListener("click",()=>{v.disconnect(),H.classList.remove("open")}),z.appendChild(e),z.appendChild(t)}else{const e=document.createElement("div");e.className="dropdown-item",e.textContent="Connect",e.addEventListener("click",()=>{v.connect(),H.classList.remove("open")}),z.appendChild(e)}};v.onStatusChange(s=>{re(s),le(s),s||(K=!1,c.clearOriginals())});q.addEventListener("click",()=>{H.classList.toggle("open")});re(!1);v.on("hierarchy",s=>{const e=s.data;if(!K){c.captureOriginals(e),K=!0;const t=c.getCurrentSessionName();if(t){const a=c.loadSession(t);a&&a.changes.size>0&&(x=t,V.textContent=t,Y(a.changes))}}k.setHierarchy(e),k.setChangedNodes(c.getChangedNodeIds())});v.on("updated",s=>{c.updateNodeLayout(s.id,s.layout,s.transform,s.layoutEnabled),s.layoutEnabled!==void 0&&k.updateNode(s.id,{layout:s.layout,layoutEnabled:s.layoutEnabled})});v.on("layout-config",s=>{const e=JSON.stringify(s.config,null,2);navigator.clipboard.writeText(e).then(()=>{alert("Layout copied to clipboard!")})});const F=()=>{const s=c.getSessions();ae.innerHTML="",s.forEach(e=>{const t=document.createElement("div");t.className="dropdown-item",e===x&&t.classList.add("selected");const a=document.createElement("span");a.className="session-name",a.textContent=e;const o=document.createElement("button");o.className="delete-btn",o.textContent="✕",o.addEventListener("click",n=>{n.stopPropagation(),confirm(`Delete session "${e}"?`)&&(c.deleteSession(e),x===e&&(x=null,V.textContent="Select Session"),F())}),t.appendChild(a),t.appendChild(o),t.addEventListener("click",async()=>{x&&c.saveSession(x);const n=c.getAllResetValues();Y(n);const l=c.loadSession(e);l&&(x=e,V.textContent=e,M.classList.remove("open"),Y(l.changes),F())}),ae.appendChild(t)})};V.addEventListener("click",()=>{V.disabled||M.classList.toggle("open")});document.addEventListener("click",s=>{M.contains(s.target)||M.classList.remove("open"),H.contains(s.target)||H.classList.remove("open")});fe.addEventListener("click",()=>{const s=prompt("New session name:");s&&s.trim()&&(c.saveSession(s.trim()),x=s.trim(),V.textContent=s.trim(),M.classList.remove("open"),F())});le(!1);F();console.log("Layout Editor loaded");
