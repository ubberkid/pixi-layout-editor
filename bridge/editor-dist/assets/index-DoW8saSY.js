var Ie=Object.defineProperty;var Le=(n,e,t)=>e in n?Ie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var C=(n,e,t)=>Le(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();class Oe{constructor(){C(this,"_channel",null);C(this,"_handlers",new Map);C(this,"_onStatusChange",null);C(this,"_connected",!1)}get isConnected(){return this._connected}onStatusChange(e){this._onStatusChange=e}on(e,t){this._handlers.has(e)||this._handlers.set(e,[]),this._handlers.get(e).push(t)}connect(){this._channel&&this._channel.close(),this._channel=new BroadcastChannel("layout-editor"),this._channel.onmessage=e=>{var o;this._connected||(this._connected=!0,(o=this._onStatusChange)==null||o.call(this,!0));const t=e.data,s=this._handlers.get(t.type);s&&s.forEach(a=>a(t))},this.send({type:"get-hierarchy"}),setTimeout(()=>{this._connected||console.log("No response from game - make sure you are in the BingoGameScene")},1e3)}disconnect(){var e,t;(e=this._channel)==null||e.close(),this._channel=null,this._connected=!1,(t=this._onStatusChange)==null||t.call(this,!1)}send(e){var t;(t=this._channel)==null||t.postMessage(e)}}const E=new Oe;class Be{constructor(e){C(this,"_container");C(this,"_hierarchy",[]);C(this,"_selectedId",null);C(this,"_expandedIds",new Set);C(this,"_changedNodeIds",new Set);C(this,"_onSelect",null);C(this,"_onHover",null);this._container=document.getElementById(e)}onSelect(e){this._onSelect=e}onHover(e){this._onHover=e}setChangedNodes(e){this._changedNodeIds=e,this.render()}getSelectedId(){return this._selectedId}setHierarchy(e){this._hierarchy=e,e.forEach(t=>this._expandedIds.add(t.id)),this.render()}getNodeById(e){const t=s=>{for(const o of s){if(o.id===e)return o;const a=t(o.children);if(a)return a}return null};return t(this._hierarchy)}updateNode(e,t){const s=this.getNodeById(e);s&&(Object.assign(s,t),this.render())}selectNodeById(e){this._selectedId=e,this.render()}render(){this._container.innerHTML="",this._hierarchy.forEach(e=>{this._container.appendChild(this.renderNode(e))})}renderNode(e){const t=document.createElement("div");t.className="tree-node";const s=e.layout&&Object.keys(e.layout).length>0,o=e.layoutEnabled!==!1,a=document.createElement("div");a.className="tree-node-header",e.id===this._selectedId&&a.classList.add("selected");const l=document.createElement("span");l.className="tree-node-toggle",e.children.length>0&&(l.textContent=this._expandedIds.has(e.id)?"▼":"▶",l.addEventListener("click",i=>{i.stopPropagation(),this.toggleExpand(e.id)}));const d=document.createElement("span");if(d.className="tree-node-label",d.textContent=e.id||`[${e.type}]`,this._changedNodeIds.has(e.id)){const i=document.createElement("span");i.className="tree-node-change-dot",i.title="Has unsaved changes",d.appendChild(i)}if(s&&o){const i=document.createElement("span");i.className="tree-node-badge",i.textContent="L",i.title="Has layout properties",d.appendChild(i)}if(e.filters&&e.filters.length>0){const i=document.createElement("span");i.className="tree-node-badge shader",i.textContent="S",i.title=`Has ${e.filters.length} filter(s)`,d.appendChild(i)}if(a.appendChild(l),a.appendChild(d),a.addEventListener("click",()=>{this.selectNode(e.id)}),a.addEventListener("mouseenter",()=>{var i;(i=this._onHover)==null||i.call(this,e.id)}),a.addEventListener("mouseleave",()=>{var i;(i=this._onHover)==null||i.call(this,null)}),t.appendChild(a),e.children.length>0){const i=document.createElement("div");i.className="tree-node-children",this._expandedIds.has(e.id)||i.classList.add("collapsed"),e.children.forEach(c=>{i.appendChild(this.renderNode(c))}),t.appendChild(i)}return t}toggleExpand(e){this._expandedIds.has(e)?this._expandedIds.delete(e):this._expandedIds.add(e),this.render()}selectNode(e){var s;this._selectedId=e,this.render();const t=this.getNodeById(e);(s=this._onSelect)==null||s.call(this,t)}}const Me=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","anchorX","anchorY","alpha"];function z(n){return Me.includes(n)}const Te=[{title:"Transform",isTransform:!0,properties:[{key:"x",type:"number",label:"x",desc:`Horizontal position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"y",type:"number",label:"y",desc:`Vertical position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"scaleX",type:"number",label:"scale.x",step:.1,desc:`Horizontal scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"scaleY",type:"number",label:"scale.y",step:.1,desc:`Vertical scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"rotation",type:"number",label:"rotation",step:.1,desc:`Rotation in radians around the pivot point.
Examples: 0, 1.57 (90°), 3.14 (180°), 6.28 (360°)`},{key:"pivotX",type:"number",label:"pivot.x",desc:`X origin for rotation/scale in local pixels.
Examples: 0 (left), width/2 (center)`},{key:"pivotY",type:"number",label:"pivot.y",desc:`Y origin for rotation/scale in local pixels.
Examples: 0 (top), height/2 (center)`},{key:"anchorX",type:"number",label:"anchor.x",step:.1,desc:`X anchor as fraction of texture (Sprites only).
Examples: 0 (left), 0.5 (center), 1 (right)`},{key:"anchorY",type:"number",label:"anchor.y",step:.1,desc:`Y anchor as fraction of texture (Sprites only).
Examples: 0 (top), 0.5 (center), 1 (bottom)`},{key:"alpha",type:"number",label:"alpha",step:.1,desc:`Opacity from 0 (invisible) to 1 (fully visible).
Examples: 1, 0.5 (semi-transparent), 0`}]},{title:"Size",properties:[{key:"width",type:"text",label:"width",desc:`Container width. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"height",type:"text",label:"height",desc:`Container height. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"minWidth",type:"number",label:"minWidth",desc:`Minimum width constraint in pixels.
Examples: 100, 200`},{key:"maxWidth",type:"number",label:"maxWidth",desc:`Maximum width constraint in pixels.
Examples: 500, 1000`},{key:"minHeight",type:"number",label:"minHeight",desc:`Minimum height constraint in pixels.
Examples: 100, 200`},{key:"maxHeight",type:"number",label:"maxHeight",desc:`Maximum height constraint in pixels.
Examples: 500, 1000`}]},{title:"Flexbox Container",properties:[{key:"flexDirection",type:"select",label:"flexDirection",desc:`Main axis direction for laying out children.
• row: left to right
• column: top to bottom
• row-reverse: right to left
• column-reverse: bottom to top`,options:["row","column","row-reverse","column-reverse"]},{key:"flexWrap",type:"select",label:"flexWrap",desc:`Whether children wrap to new lines.
• nowrap: single line, may overflow
• wrap: wrap to next line
• wrap-reverse: wrap upward/leftward`,options:["nowrap","wrap","wrap-reverse"]},{key:"justifyContent",type:"select",label:"justifyContent",desc:`Align children along the main axis.
• flex-start: pack at start
• flex-end: pack at end
• center: center items
• space-between: equal space between
• space-around: equal space around
• space-evenly: equal space everywhere`,options:["flex-start","flex-end","center","space-between","space-around","space-evenly"]},{key:"alignItems",type:"select",label:"alignItems",desc:`Align children along the cross axis.
• flex-start: align to start
• flex-end: align to end
• center: center items
• stretch: stretch to fill
• baseline: align text baselines`,options:["flex-start","flex-end","center","stretch","baseline"]},{key:"alignContent",type:"select",label:"alignContent",desc:`Align wrapped lines (only with flexWrap).
• flex-start: pack lines at start
• flex-end: pack lines at end
• center: center lines
• stretch: stretch lines to fill
• space-between: equal space between lines
• space-around: equal space around lines`,options:["flex-start","flex-end","center","stretch","space-between","space-around"]},{key:"gap",type:"number",label:"gap",desc:`Space between all children in pixels.
Examples: 0, 10, 20`},{key:"rowGap",type:"number",label:"rowGap",desc:`Space between rows in pixels (overrides gap for rows).
Examples: 0, 10, 20`},{key:"columnGap",type:"number",label:"columnGap",desc:`Space between columns in pixels (overrides gap for columns).
Examples: 0, 10, 20`}]},{title:"Flexbox Item",properties:[{key:"flex",type:"number",label:"flex",desc:`Shorthand for flex-grow. How much this item grows relative to siblings.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexGrow",type:"number",label:"flexGrow",desc:`How much this item grows to fill extra space.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexShrink",type:"number",label:"flexShrink",desc:`How much this item shrinks when space is tight.
Examples: 0 (don't shrink), 1 (shrink equally)`},{key:"flexBasis",type:"number",label:"flexBasis",desc:`Initial size before growing/shrinking, in pixels.
Examples: 0, 100, 200`},{key:"alignSelf",type:"select",label:"alignSelf",desc:`Override parent's alignItems for this item.
• auto: use parent's alignItems
• flex-start/end/center/stretch/baseline: same as alignItems`,options:["auto","flex-start","flex-end","center","stretch","baseline"]}]},{title:"Spacing",properties:[{key:"padding",type:"number",label:"padding",desc:`Inner spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"paddingTop",type:"number",label:"paddingTop",desc:`Inner spacing at top in pixels.
Examples: 0, 10, 20`},{key:"paddingRight",type:"number",label:"paddingRight",desc:`Inner spacing at right in pixels.
Examples: 0, 10, 20`},{key:"paddingBottom",type:"number",label:"paddingBottom",desc:`Inner spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"paddingLeft",type:"number",label:"paddingLeft",desc:`Inner spacing at left in pixels.
Examples: 0, 10, 20`},{key:"margin",type:"number",label:"margin",desc:`Outer spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"marginTop",type:"number",label:"marginTop",desc:`Outer spacing at top in pixels.
Examples: 0, 10, 20`},{key:"marginRight",type:"number",label:"marginRight",desc:`Outer spacing at right in pixels.
Examples: 0, 10, 20`},{key:"marginBottom",type:"number",label:"marginBottom",desc:`Outer spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"marginLeft",type:"number",label:"marginLeft",desc:`Outer spacing at left in pixels.
Examples: 0, 10, 20`}]}],te="layout-editor-sessions",W="layout-editor-current-session";class Pe{constructor(e,t){C(this,"_formContainer");C(this,"_selectedNode",null);C(this,"_liveOriginals",new Map);C(this,"_sessionChanges",new Map);C(this,"_hasUnsavedChanges",!1);C(this,"_onChange",null);C(this,"_onCopy",null);C(this,"_onChangesUpdated",null);C(this,"_onReset",null);this._formContainer=document.getElementById(e),localStorage.removeItem("layout-editor-changes"),localStorage.removeItem("layout-editor-originals"),localStorage.removeItem("layout-editor-transforms")}captureOriginals(e){this._liveOriginals.clear();const t=s=>{this._liveOriginals.set(s.id,{layout:s.layout?{...s.layout}:{},transform:s.transform?{...s.transform}:{},layoutEnabled:s.layoutEnabled}),s.children.forEach(t)};e.forEach(t),console.log(`[PropertyPanel] Captured originals for ${this._liveOriginals.size} nodes`)}clearOriginals(){this._liveOriginals.clear()}getOriginalValue(e,t,s){const o=this._liveOriginals.get(e);if(o)return t==="_layoutEnabled"?o.layoutEnabled:s?o.transform[t]:o.layout[t]}getSessionChanges(){return this._sessionChanges}hasUnsavedChanges(){return this._hasUnsavedChanges}hasOriginals(){return this._liveOriginals.size>0}clearCurrentSession(){localStorage.removeItem(W)}getSessions(){try{const e=localStorage.getItem(te);return e?JSON.parse(e):[]}catch{return[]}}saveSession(e){try{const t={};for(const[a,l]of this._sessionChanges){const d={},h=this._liveOriginals.get(a);for(const[i,c]of Object.entries(l)){let r;if(i==="_layoutEnabled")r=h==null?void 0:h.layoutEnabled;else{const p=z(i);r=h?p?h.transform[i]:h.layout[i]:void 0}c!==r&&(d[i]=c)}Object.keys(d).length>0&&(t[a]=d)}const s={changes:t};localStorage.setItem(`layout-editor-session-${e}`,JSON.stringify(s));const o=this.getSessions();o.includes(e)||(o.push(e),localStorage.setItem(te,JSON.stringify(o))),localStorage.setItem(W,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Saved session: ${e} (${Object.keys(t).length} nodes)`)}catch(t){console.warn("[PropertyPanel] Failed to save session:",t)}}loadSession(e){var t;try{const s=localStorage.getItem(`layout-editor-session-${e}`);if(!s)return null;const o=JSON.parse(s);this._sessionChanges.clear();let a=0;for(const[l,d]of Object.entries(o.changes)){const h={},i=this._liveOriginals.get(l);for(const[c,r]of Object.entries(d)){let p;if(c==="_layoutEnabled")p=i==null?void 0:i.layoutEnabled;else{const u=z(c);p=i?u?i.transform[c]:i.layout[c]:void 0}r!==p?h[c]=r:a++}Object.keys(h).length>0&&this._sessionChanges.set(l,h)}return localStorage.setItem(W,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Loaded session: ${e} (skipped ${a} matching values)`),(t=this._onChangesUpdated)==null||t.call(this),this.render(),{changes:this._sessionChanges,skipped:a}}catch(s){return console.warn("[PropertyPanel] Failed to load session:",s),null}}deleteSession(e){try{localStorage.removeItem(`layout-editor-session-${e}`);const t=this.getSessions().filter(s=>s!==e);localStorage.setItem(te,JSON.stringify(t)),console.log(`[PropertyPanel] Deleted session: ${e}`)}catch(t){console.warn("[PropertyPanel] Failed to delete session:",t)}}getCurrentSessionName(){return localStorage.getItem(W)}onChange(e){this._onChange=e}onCopy(e){this._onCopy=e}onChangesUpdated(e){this._onChangesUpdated=e}onReset(e){this._onReset=e}getAllResetValues(){const e=new Map;for(const[t,s]of this._sessionChanges){const o=this._liveOriginals.get(t);if(!o)continue;const a={};for(const l of Object.keys(s))if(l==="_layoutEnabled")a[l]=o.layoutEnabled;else{const d=z(l);a[l]=d?o.transform[l]:o.layout[l]}Object.keys(a).length>0&&e.set(t,a)}return e}resetNode(e){var a,l;const t=this._liveOriginals.get(e);if(!t)return;const s=this._sessionChanges.get(e);if(!s)return;const o={};for(const d of Object.keys(s))if(d==="_layoutEnabled")o[d]=t.layoutEnabled;else{const h=z(d);o[d]=h?t.transform[d]:t.layout[d]}this._sessionChanges.delete(e),this._hasUnsavedChanges=!0,(a=this._onReset)==null||a.call(this,e,o),(l=this._onChangesUpdated)==null||l.call(this),this.render()}getChangedNodeIds(){return new Set(this._sessionChanges.keys())}setSelectedNode(e){this._selectedNode=e,this.render()}updateNodeLayout(e,t,s,o){var a;if(((a=this._selectedNode)==null?void 0:a.id)===e&&(this._selectedNode.layout=t,s&&(this._selectedNode.transform=s),o!==void 0)){const l=this._selectedNode.layoutEnabled!==o;this._selectedNode.layoutEnabled=o,l&&this.render()}}render(){var pe,he,ue;if(!this._selectedNode){this._formContainer.style.display="none";return}this._formContainer.style.display="block",this._formContainer.innerHTML="";const e=document.createElement("div");e.id="selected-name-row";const t=document.createElement("div");if(t.id="selected-name",t.textContent=this._selectedNode.id,e.appendChild(t),this._sessionChanges.has(this._selectedNode.id)){const v=document.createElement("button");v.id="reset-node-btn",v.textContent="Reset",v.title="Reset all changes for this node",v.addEventListener("click",()=>{this.resetNode(this._selectedNode.id)}),e.appendChild(v)}this._formContainer.appendChild(e);const s=document.createElement("div");s.className="property-row toggle-row";const o=document.createElement("label");o.className="property-label",o.textContent="Layout Enabled";const a=this._selectedNode.id,l=this._liveOriginals.get(a),d=this._sessionChanges.get(a)||{},h=(l==null?void 0:l.layoutEnabled)??!1,i=d._layoutEnabled,c=i!==void 0?i:this._selectedNode.layoutEnabled,r=document.createElement("input");r.type="checkbox",r.checked=c;const p=document.createElement("span");p.className="property-original";const u=()=>{r.checked!==h?(p.textContent=`was: ${h?"on":"off"}`,p.style.display="inline",p.title="Click to reset"):p.style.display="none"};u(),p.setAttribute("role","button"),p.setAttribute("tabindex","0");const k=()=>{r.checked=h,u(),H(h)};p.addEventListener("click",k),p.addEventListener("keydown",v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),k())});const H=v=>{var V,y,B,M,m,T,_,P,x,R,f;this._sessionChanges.has(a)||this._sessionChanges.set(a,{});const O=this._sessionChanges.get(a);if(v!==h?(O._layoutEnabled=v,this._hasUnsavedChanges=!0):(delete O._layoutEnabled,Object.keys(O).length===0&&this._sessionChanges.delete(a)),(V=this._onChangesUpdated)==null||V.call(this),u(),v)(y=this._onChange)==null||y.call(this,a,"_layoutEnabled",!0);else{const N=((M=(B=this._selectedNode)==null?void 0:B.transform)==null?void 0:M.alpha)??1;(m=this._onChange)==null||m.call(this,a,"alpha",N+1e-4),(T=this._onChange)==null||T.call(this,a,"_layoutEnabled",!1);const b=this._liveOriginals.get(a);if(b!=null&&b.transform){const ee=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","alpha"];for(const D of ee){const j=b.transform[D];j!==void 0&&((_=this._onChange)==null||_.call(this,a,D,j))}(x=(P=this._selectedNode)==null?void 0:P.transform)!=null&&x.hasAnchor&&(b.transform.anchorX!==void 0&&((R=this._onChange)==null||R.call(this,a,"anchorX",b.transform.anchorX)),b.transform.anchorY!==void 0&&((f=this._onChange)==null||f.call(this,a,"anchorY",b.transform.anchorY)))}}};r.addEventListener("change",()=>{H(r.checked)}),s.appendChild(o),s.appendChild(r),s.appendChild(p),this._formContainer.appendChild(s);const L=this._liveOriginals.get(this._selectedNode.id),A=(L==null?void 0:L.layout)||{},de=(L==null?void 0:L.transform)||{},ke=this._sessionChanges.get(this._selectedNode.id)||{};for(const v of Te){const O=document.createElement("div");O.className="property-section";const V=document.createElement("div");V.className="property-section-title",V.textContent=v.title,O.appendChild(V);for(const y of v.properties){if((y.key==="anchorX"||y.key==="anchorY")&&!((pe=this._selectedNode.transform)!=null&&pe.hasAnchor))continue;const B=document.createElement("div");B.className="property-row";const M=document.createElement("label");M.className="property-label",M.textContent=y.label,M.title=y.desc;let m;if(y.type==="select"){m=document.createElement("select"),m.className="property-input";const f=document.createElement("option");f.value="",f.textContent="(not set)",m.appendChild(f),y.options.forEach(N=>{const b=document.createElement("option");b.value=N,b.textContent=N,m.appendChild(b)})}else m=document.createElement("input"),m.className="property-input",m.type=y.type==="number"?"number":"text",y.step!==void 0&&(m.step=String(y.step));let T,_;const P=ke[y.key];if(v.isTransform){const f=y.key;T=P!==void 0?P:(he=this._selectedNode.transform)==null?void 0:he[f],_=de[y.key]}else T=P!==void 0?P:(ue=this._selectedNode.layout)==null?void 0:ue[y.key],_=A[y.key];T!==void 0&&(m.value=String(T),m.classList.add("has-value")),m instanceof HTMLInputElement&&(m.placeholder="(not set)");const x=document.createElement("span");x.className="property-original";const R=()=>{const f=m.value===""?void 0:m.value,N=_!==void 0?String(_):void 0,b=f!==N;b&&_!==void 0?(x.textContent=`was: ${_}`,x.style.display="inline",x.title="Click to reset"):b&&_===void 0?(x.textContent="new",x.style.display="inline",x.title="Click to clear"):x.style.display="none"};R(),x.setAttribute("role","button"),x.setAttribute("tabindex","0"),x.addEventListener("click",()=>{var f;_!==void 0?m.value=String(_):m.value="",m.classList.toggle("has-value",m.value!==""),R(),(f=this._onChange)==null||f.call(this,this._selectedNode.id,y.key,_)}),x.addEventListener("keydown",f=>{var N;(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),_!==void 0?m.value=String(_):m.value="",m.classList.toggle("has-value",m.value!==""),R(),(N=this._onChange)==null||N.call(this,this._selectedNode.id,y.key,_))}),m.addEventListener("change",()=>{var D,j;m.classList.toggle("has-value",m.value!==""),R();let f=m.value;y.type==="number"&&f!==""&&(f=parseFloat(f)),f===""&&!v.isTransform&&(f=void 0);const N=this._selectedNode.id;this._sessionChanges.has(N)||this._sessionChanges.set(N,{});const b=this._sessionChanges.get(N),ee=v.isTransform?de[y.key]:A[y.key];f!==ee?(b[y.key]=f,this._hasUnsavedChanges=!0):(delete b[y.key],Object.keys(b).length===0&&this._sessionChanges.delete(N)),(D=this._onChangesUpdated)==null||D.call(this),(j=this._onChange)==null||j.call(this,this._selectedNode.id,y.key,f)}),B.appendChild(M),B.appendChild(m),B.appendChild(x),O.appendChild(B)}this._formContainer.appendChild(O)}const Y=document.createElement("button");Y.id="copy-btn",Y.textContent="Copy Layout",Y.addEventListener("click",()=>{var v;(v=this._onCopy)==null||v.call(this,this._selectedNode.id)}),this._formContainer.appendChild(Y)}}function me(n){const e=Math.round(Math.max(0,Math.min(1,n[0]))*255),t=Math.round(Math.max(0,Math.min(1,n[1]))*255),s=Math.round(Math.max(0,Math.min(1,n[2]))*255);return`#${e.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}function ge(n){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]:[1,1,1]}function Re(n){return!Array.isArray(n)||n.length!==3?!1:n.every(e=>typeof e=="number"&&e>=0&&e<=1)}function fe(n){return["color","Color","COLOR","tint","Tint","rgb","RGB"].some(t=>n.includes(t))}class He{constructor(e,t){C(this,"_container");C(this,"_noFiltersEl");C(this,"_selectedNode",null);C(this,"_onChange",null);this._container=document.getElementById(e),this._noFiltersEl=document.getElementById(t)}onChange(e){this._onChange=e}setSelectedNode(e){this._selectedNode=e,this.render()}hasFilters(){var e;return!!((e=this._selectedNode)!=null&&e.filters&&this._selectedNode.filters.length>0)}updateFilterUniforms(e,t,s){var o;if(((o=this._selectedNode)==null?void 0:o.id)===e&&this._selectedNode.filters){const a=this._selectedNode.filters.find(l=>l.index===t);a&&(a.uniforms=s)}}render(){if(!this._selectedNode||!this._selectedNode.filters||this._selectedNode.filters.length===0){this._container.style.display="none",this._noFiltersEl.style.display="block";return}this._noFiltersEl.style.display="none",this._container.style.display="block",this._container.innerHTML="";for(const e of this._selectedNode.filters){const t=this.createFilterSection(e);this._container.appendChild(t)}}createFilterSection(e){const t=document.createElement("div");t.className="filter-section";const s=document.createElement("div");s.className="filter-section-header",s.innerHTML=`<span class="filter-toggle">▼</span> ${e.className}`;const o=document.createElement("div");o.className="filter-section-content",s.addEventListener("click",()=>{const l=o.classList.toggle("collapsed");s.querySelector(".filter-toggle").textContent=l?"▶":"▼"}),t.appendChild(s);const a=new Map;for(const l of e.uniforms){const d=a.get(l.groupName)||[];d.push(l),a.set(l.groupName,d)}for(const[l,d]of a)for(const h of d){const i=this.createUniformRow(e,h);o.appendChild(i)}return t.appendChild(o),t}createUniformRow(e,t){const s=document.createElement("div");s.className="filter-row";const o=document.createElement("label");o.className="filter-label";const a=t.name.startsWith("u")&&t.name.length>1&&t.name[1]===t.name[1].toUpperCase()?t.name.slice(1).charAt(0).toLowerCase()+t.name.slice(2):t.name;o.textContent=a,o.title=`${t.name} (${t.type})`,s.appendChild(o);const l=this.createUniformControl(e,t);return s.appendChild(l),s}createUniformControl(e,t){const{type:s,value:o,name:a,groupName:l}=t,d=this._selectedNode.id,h=e.index,i=document.createElement("div");if(i.className="filter-control-wrapper",s==="f32"){const c=document.createElement("div");c.className="filter-slider-container";const r=document.createElement("input");r.type="range",r.className="filter-slider",r.min="0",r.max=this.inferSliderMax(a,o),r.step=this.inferSliderStep(a,o),r.value=String(o);const p=document.createElement("input");p.type="number",p.className="filter-number",p.step=r.step,p.value=String(o);const u=k=>{var H;r.value=String(k),p.value=String(k),(H=this._onChange)==null||H.call(this,d,h,l,a,k)};r.addEventListener("input",()=>u(parseFloat(r.value))),p.addEventListener("change",()=>u(parseFloat(p.value))),c.appendChild(r),c.appendChild(p),i.appendChild(c)}else if(s==="vec3<f32>"){const c=o;if(Re(c)||fe(a)){const r=document.createElement("input");r.type="color",r.className="filter-color",r.value=me(c),r.addEventListener("input",()=>{var u;const p=ge(r.value);(u=this._onChange)==null||u.call(this,d,h,l,a,p)}),i.appendChild(r)}else{const r=this.createVectorInputs(c,3,p=>{var u;(u=this._onChange)==null||u.call(this,d,h,l,a,p)});i.appendChild(r)}}else if(s==="vec2<f32>"){const c=o,r=this.createVectorInputs(c,2,p=>{var u;(u=this._onChange)==null||u.call(this,d,h,l,a,p)});i.appendChild(r)}else if(s==="vec4<f32>"){const c=o;if(c.every(r=>r>=0&&r<=1)&&fe(a)){const r=document.createElement("div");r.className="filter-color-alpha-container";const p=document.createElement("input");p.type="color",p.className="filter-color",p.value=me(c.slice(0,3));const u=document.createElement("input");u.type="range",u.className="filter-slider filter-alpha-slider",u.min="0",u.max="1",u.step="0.01",u.value=String(c[3]);const k=()=>{var A;const L=[...ge(p.value),parseFloat(u.value)];(A=this._onChange)==null||A.call(this,d,h,l,a,L)};p.addEventListener("input",k),u.addEventListener("input",k),r.appendChild(p),r.appendChild(u),i.appendChild(r)}else{const r=this.createVectorInputs(c,4,p=>{var u;(u=this._onChange)==null||u.call(this,d,h,l,a,p)});i.appendChild(r)}}else if(s==="bool"){const c=document.createElement("input");c.type="checkbox",c.className="filter-checkbox",c.checked=!!o,c.addEventListener("change",()=>{var r;(r=this._onChange)==null||r.call(this,d,h,l,a,c.checked)}),i.appendChild(c)}else{const c=document.createElement("input");c.type="text",c.className="filter-text",c.value=JSON.stringify(o),c.disabled=!0,c.title=`Unknown type: ${s}`,i.appendChild(c)}return i}createVectorInputs(e,t,s){const o=document.createElement("div");o.className="filter-vector-container";const a=["x","y","z","w"],l=[];for(let d=0;d<t;d++){const h=document.createElement("div");h.className="filter-vector-input";const i=document.createElement("span");i.className="filter-vector-label",i.textContent=a[d];const c=document.createElement("input");c.type="number",c.className="filter-number filter-vector-number",c.step="0.01",c.value=String(e[d]??0),c.addEventListener("change",()=>{const r=l.map(p=>parseFloat(p.value));s(r)}),l.push(c),h.appendChild(i),h.appendChild(c),o.appendChild(h)}return o}inferSliderMax(e,t){const s=e.toLowerCase();return s.includes("alpha")||s.includes("opacity")||s.includes("progress")?"1":s.includes("angle")?String(Math.PI*2):s.includes("intensity")||s.includes("strength")||s.includes("frequency")?"20":s.includes("speed")?"10":t<=1?"1":t<=10?"10":t<=100?"100":String(Math.ceil(t*2))}inferSliderStep(e,t){const s=e.toLowerCase();return s.includes("alpha")||s.includes("opacity")||s.includes("progress")?"0.01":t<.1?"0.001":t<1?"0.01":t<10?"0.1":"1"}}const $=document.getElementById("connection-dropdown"),G=document.getElementById("connection-dropdown-btn"),q=document.getElementById("connection-dropdown-menu"),F=document.getElementById("session-dropdown"),U=document.getElementById("session-dropdown-btn"),ye=document.getElementById("session-list"),Ve=document.getElementById("session-create"),ve=document.getElementById("view-changes-btn"),I=document.getElementById("changes-modal"),ne=document.getElementById("changes-list"),$e=document.getElementById("close-modal-btn"),Fe=document.getElementById("reset-all-btn"),be=document.getElementById("highlight-mode"),Ee=document.getElementById("tab-layout"),K=document.getElementById("tab-filters"),Ce=document.getElementById("no-selection"),se=document.getElementById("layout-content"),oe=document.getElementById("filters-content");let w=null,ae=!1;const S=new Be("tree-view"),g=new Pe("property-form","no-selection"),le=new He("filter-form","no-filters");let J="layout";const re=n=>{J=n,Ee.classList.toggle("active",n==="layout"),K.classList.toggle("active",n==="filters"),se.style.display=n==="layout"?"block":"none",oe.style.display=n==="filters"?"block":"none"};Ee.addEventListener("click",()=>re("layout"));K.addEventListener("click",()=>{K.disabled||re("filters")});const Ue=n=>{const e=!!(n!=null&&n.filters&&n.filters.length>0);K.disabled=!e,n?(Ce.style.display="none",se.style.display=J==="layout"?"block":"none",oe.style.display=J==="filters"?"block":"none"):(Ce.style.display="block",se.style.display="none",oe.style.display="none"),J==="filters"&&!e&&re("layout")},X=n=>{var e;if(n.size>0){console.log(`[Layout Editor] Applying ${n.size} node changes...`);for(const[t,s]of n)for(const[o,a]of Object.entries(s)){if(o==="_layoutEnabled"&&a===!1){const l=S.getNodeById(t),d=((e=l==null?void 0:l.transform)==null?void 0:e.alpha)??1;E.send({type:"set-property",id:t,property:"alpha",value:d+1e-4})}E.send({type:"set-property",id:t,property:o,value:a})}}},_e=n=>{F.style.display=n?"block":"none",ve.style.display=n?"inline-block":"none"},ce=n=>{const e=be.value;e==="none"?E.send({type:"highlight",id:null}):E.send({type:"highlight",id:n,showChildren:e==="children"})};S.onSelect(n=>{g.setSelectedNode(n),le.setSelectedNode(n),Ue(n),ce((n==null?void 0:n.id)||null)});S.onHover(n=>{const e=n??S.getSelectedId();ce(e)});be.addEventListener("change",()=>{const n=S.getSelectedId();ce(n)});g.onChange((n,e,t)=>{E.send({type:"set-property",id:n,property:e,value:t}),w&&g.saveSession(w)});g.onChangesUpdated(()=>{S.setChangedNodes(g.getChangedNodeIds())});g.onCopy(n=>{E.send({type:"get-layout",id:n})});g.onReset((n,e)=>{var t;for(const[s,o]of Object.entries(e)){if(s==="_layoutEnabled"&&o===!1){const a=S.getNodeById(n),l=((t=a==null?void 0:a.transform)==null?void 0:t.alpha)??1;E.send({type:"set-property",id:n,property:"alpha",value:l+1e-4})}E.send({type:"set-property",id:n,property:s,value:o})}});le.onChange((n,e,t,s,o)=>{E.send({type:"set-filter-uniform",id:n,filterIndex:e,groupName:t,uniformName:s,value:o})});const Ae=()=>{ne.innerHTML="";const n=g.getSessionChanges();if(n.size===0){ne.innerHTML='<p style="color: #808080;">No changes</p>';return}for(const[e,t]of n){const s=document.createElement("div");s.className="change-node";const o=document.createElement("div");o.className="change-node-header",o.textContent=e,o.addEventListener("click",()=>{const a=S.getNodeById(e);a&&(g.setSelectedNode(a),S.selectNodeById(e)),I.style.display="none"}),s.appendChild(o);for(const[a,l]of Object.entries(t)){const d=z(a),h=g.getOriginalValue(e,a,d),i=document.createElement("div");i.className="change-item",i.innerHTML=`
        <span class="change-prop">${a}:</span>
        <span class="change-old">${h??"(not set)"}</span>
        <span class="change-arrow">→</span>
        <span class="change-new">${l??"(not set)"}</span>
      `,s.appendChild(i)}ne.appendChild(s)}};ve.addEventListener("click",()=>{Ae(),I.style.display="flex"});$e.addEventListener("click",()=>{I.style.display="none"});I.addEventListener("click",n=>{n.target===I&&(I.style.display="none")});document.addEventListener("keydown",n=>{n.key==="Escape"&&I.style.display!=="none"&&(I.style.display="none")});Fe.addEventListener("click",()=>{if(confirm("Reset all changes?")){const n=g.getSessionChanges();for(const[e]of n)g.resetNode(e);I.style.display="none"}});const xe=n=>{if(G.textContent=n?"Connected":"Disconnected",G.classList.toggle("connected",n),G.classList.toggle("disconnected",!n),q.innerHTML="",n){const e=document.createElement("div");e.className="dropdown-item",e.textContent="Refresh",e.addEventListener("click",()=>{const s=g.getAllResetValues();if(X(s),w){const o=g.loadSession(w);o&&X(o.changes)}else g.getSessionChanges().clear(),S.setChangedNodes(g.getChangedNodeIds());E.send({type:"get-hierarchy"}),$.classList.remove("open")});const t=document.createElement("div");t.className="dropdown-item",t.textContent="Disconnect",t.addEventListener("click",()=>{E.disconnect(),$.classList.remove("open")}),q.appendChild(e),q.appendChild(t)}else{const e=document.createElement("div");e.className="dropdown-item",e.textContent="Connect",e.addEventListener("click",()=>{E.connect(),$.classList.remove("open")}),q.appendChild(e)}};E.onStatusChange(n=>{xe(n),_e(n),n||(ae=!1,g.clearOriginals())});G.addEventListener("click",()=>{$.classList.toggle("open")});xe(!1);E.on("hierarchy",n=>{const e=n.data;if(!ae){g.captureOriginals(e),ae=!0;const t=g.getCurrentSessionName();if(t){const s=g.loadSession(t);s&&s.changes.size>0&&(w=t,U.textContent=t,X(s.changes))}}S.setHierarchy(e),S.setChangedNodes(g.getChangedNodeIds())});E.on("updated",n=>{g.updateNodeLayout(n.id,n.layout,n.transform,n.layoutEnabled),n.layoutEnabled!==void 0&&S.updateNode(n.id,{layout:n.layout,layoutEnabled:n.layoutEnabled})});E.on("layout-config",n=>{const e=JSON.stringify(n.config,null,2);navigator.clipboard.writeText(e).then(()=>{alert("Layout copied to clipboard!")})});E.on("filter-updated",n=>{le.updateFilterUniforms(n.id,n.filterIndex,n.uniforms)});const Q=()=>{const n=g.getSessions();ye.innerHTML="",n.forEach(e=>{const t=document.createElement("div");t.className="dropdown-item",e===w&&t.classList.add("selected");const s=document.createElement("span");s.className="session-name",s.textContent=e;const o=document.createElement("button");o.className="delete-btn",o.textContent="✕",o.addEventListener("click",a=>{a.stopPropagation(),confirm(`Delete session "${e}"?`)&&(g.deleteSession(e),w===e&&(w=null,U.textContent="Select Session"),Q())}),t.appendChild(s),t.appendChild(o),t.addEventListener("click",async()=>{w&&g.saveSession(w);const a=g.getAllResetValues();X(a);const l=g.loadSession(e);l&&(w=e,U.textContent=e,F.classList.remove("open"),X(l.changes),Q())}),ye.appendChild(t)})};U.addEventListener("click",()=>{U.disabled||F.classList.toggle("open")});document.addEventListener("click",n=>{F.contains(n.target)||F.classList.remove("open"),$.contains(n.target)||$.classList.remove("open")});Ve.addEventListener("click",()=>{const n=prompt("New session name:");n&&n.trim()&&(g.saveSession(n.trim()),w=n.trim(),U.textContent=n.trim(),F.classList.remove("open"),Q())});_e(!1);Q();const ie=document.getElementById("resize-handle"),Ne=document.getElementById("tree-panel");let Z=!1,Se=0,we=0;ie.addEventListener("mousedown",n=>{Z=!0,Se=n.clientX,we=Ne.offsetWidth,ie.classList.add("dragging"),document.body.style.cursor="col-resize",document.body.style.userSelect="none",n.preventDefault()});document.addEventListener("mousemove",n=>{if(!Z)return;const e=n.clientX-Se,t=Math.max(150,Math.min(600,we+e));Ne.style.width=`${t}px`});document.addEventListener("mouseup",()=>{Z&&(Z=!1,ie.classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect="")});console.log("Layout Editor loaded");
