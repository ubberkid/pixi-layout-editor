var oe=Object.defineProperty;var ae=(n,e,t)=>e in n?oe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>ae(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();class ie{constructor(){m(this,"_channel",null);m(this,"_handlers",new Map);m(this,"_onStatusChange",null);m(this,"_connected",!1)}get isConnected(){return this._connected}onStatusChange(e){this._onStatusChange=e}on(e,t){this._handlers.has(e)||this._handlers.set(e,[]),this._handlers.get(e).push(t)}connect(){this._channel&&this._channel.close(),this._channel=new BroadcastChannel("layout-editor"),this._channel.onmessage=e=>{var a;this._connected||(this._connected=!0,(a=this._onStatusChange)==null||a.call(this,!0));const t=e.data,s=this._handlers.get(t.type);s&&s.forEach(o=>o(t))},this.send({type:"get-hierarchy"}),setTimeout(()=>{this._connected||console.log("No response from game - make sure you are in the BingoGameScene")},1e3)}disconnect(){var e,t;(e=this._channel)==null||e.close(),this._channel=null,this._connected=!1,(t=this._onStatusChange)==null||t.call(this,!1)}send(e){var t;(t=this._channel)==null||t.postMessage(e)}}const b=new ie;class le{constructor(e){m(this,"_container");m(this,"_hierarchy",[]);m(this,"_selectedId",null);m(this,"_expandedIds",new Set);m(this,"_changedNodeIds",new Set);m(this,"_onSelect",null);m(this,"_onHover",null);this._container=document.getElementById(e)}onSelect(e){this._onSelect=e}onHover(e){this._onHover=e}setChangedNodes(e){this._changedNodeIds=e,this.render()}getSelectedId(){return this._selectedId}setHierarchy(e){this._hierarchy=e,e.forEach(t=>this._expandedIds.add(t.id)),this.render()}getNodeById(e){const t=s=>{for(const a of s){if(a.id===e)return a;const o=t(a.children);if(o)return o}return null};return t(this._hierarchy)}updateNode(e,t){const s=this.getNodeById(e);s&&(Object.assign(s,t),this.render())}selectNodeById(e){this._selectedId=e,this.render()}render(){this._container.innerHTML="",this._hierarchy.forEach(e=>{this._container.appendChild(this.renderNode(e))})}renderNode(e){const t=document.createElement("div");t.className="tree-node";const s=e.layout&&Object.keys(e.layout).length>0,a=e.layoutEnabled!==!1,o=document.createElement("div");o.className="tree-node-header",e.id===this._selectedId&&o.classList.add("selected"),a?s||o.classList.add("tree-node-no-layout"):o.classList.add("tree-node-disabled");const r=document.createElement("span");r.className="tree-node-toggle",e.children.length>0&&(r.textContent=this._expandedIds.has(e.id)?"▼":"▶",r.addEventListener("click",i=>{i.stopPropagation(),this.toggleExpand(e.id)}));const h=document.createElement("span");if(h.className="tree-node-label",h.textContent=e.id||`[${e.type}]`,this._changedNodeIds.has(e.id)){const i=document.createElement("span");i.className="tree-node-change-dot",i.title="Has unsaved changes",h.appendChild(i)}if(a){if(s){const i=document.createElement("span");i.className="tree-node-badge",i.textContent="L",i.title="Has layout properties",h.appendChild(i)}}else{const i=document.createElement("span");i.className="tree-node-badge disabled",i.textContent="✗",i.title="Layout disabled",h.appendChild(i)}if(o.appendChild(r),o.appendChild(h),o.addEventListener("click",()=>{this.selectNode(e.id)}),o.addEventListener("mouseenter",()=>{var i;(i=this._onHover)==null||i.call(this,e.id)}),o.addEventListener("mouseleave",()=>{var i;(i=this._onHover)==null||i.call(this,null)}),t.appendChild(o),e.children.length>0){const i=document.createElement("div");i.className="tree-node-children",this._expandedIds.has(e.id)||i.classList.add("collapsed"),e.children.forEach(f=>{i.appendChild(this.renderNode(f))}),t.appendChild(i)}return t}toggleExpand(e){this._expandedIds.has(e)?this._expandedIds.delete(e):this._expandedIds.add(e),this.render()}selectNode(e){var s;this._selectedId=e,this.render();const t=this.getNodeById(e);(s=this._onSelect)==null||s.call(this,t)}}const re=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","anchorX","anchorY","alpha"];function j(n){return re.includes(n)}const ce=[{title:"Transform",isTransform:!0,properties:[{key:"x",type:"number",label:"x",desc:`Horizontal position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"y",type:"number",label:"y",desc:`Vertical position in pixels relative to parent.
Examples: 0, 100, -50`},{key:"scaleX",type:"number",label:"scale.x",step:.1,desc:`Horizontal scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"scaleY",type:"number",label:"scale.y",step:.1,desc:`Vertical scale multiplier. 1 = normal size.
Examples: 1, 0.5 (half), 2 (double), -1 (flip)`},{key:"rotation",type:"number",label:"rotation",step:.1,desc:`Rotation in radians around the pivot point.
Examples: 0, 1.57 (90°), 3.14 (180°), 6.28 (360°)`},{key:"pivotX",type:"number",label:"pivot.x",desc:`X origin for rotation/scale in local pixels.
Examples: 0 (left), width/2 (center)`},{key:"pivotY",type:"number",label:"pivot.y",desc:`Y origin for rotation/scale in local pixels.
Examples: 0 (top), height/2 (center)`},{key:"anchorX",type:"number",label:"anchor.x",step:.1,desc:`X anchor as fraction of texture (Sprites only).
Examples: 0 (left), 0.5 (center), 1 (right)`},{key:"anchorY",type:"number",label:"anchor.y",step:.1,desc:`Y anchor as fraction of texture (Sprites only).
Examples: 0 (top), 0.5 (center), 1 (bottom)`},{key:"alpha",type:"number",label:"alpha",step:.1,desc:`Opacity from 0 (invisible) to 1 (fully visible).
Examples: 1, 0.5 (semi-transparent), 0`}]},{title:"Size",properties:[{key:"width",type:"text",label:"width",desc:`Container width. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"height",type:"text",label:"height",desc:`Container height. Accepts pixels or percentage.
Examples: 100, "50%", "auto"`},{key:"minWidth",type:"number",label:"minWidth",desc:`Minimum width constraint in pixels.
Examples: 100, 200`},{key:"maxWidth",type:"number",label:"maxWidth",desc:`Maximum width constraint in pixels.
Examples: 500, 1000`},{key:"minHeight",type:"number",label:"minHeight",desc:`Minimum height constraint in pixels.
Examples: 100, 200`},{key:"maxHeight",type:"number",label:"maxHeight",desc:`Maximum height constraint in pixels.
Examples: 500, 1000`}]},{title:"Flexbox Container",properties:[{key:"flexDirection",type:"select",label:"flexDirection",desc:`Main axis direction for laying out children.
• row: left to right
• column: top to bottom
• row-reverse: right to left
• column-reverse: bottom to top`,options:["row","column","row-reverse","column-reverse"]},{key:"flexWrap",type:"select",label:"flexWrap",desc:`Whether children wrap to new lines.
• nowrap: single line, may overflow
• wrap: wrap to next line
• wrap-reverse: wrap upward/leftward`,options:["nowrap","wrap","wrap-reverse"]},{key:"justifyContent",type:"select",label:"justifyContent",desc:`Align children along the main axis.
• flex-start: pack at start
• flex-end: pack at end
• center: center items
• space-between: equal space between
• space-around: equal space around
• space-evenly: equal space everywhere`,options:["flex-start","flex-end","center","space-between","space-around","space-evenly"]},{key:"alignItems",type:"select",label:"alignItems",desc:`Align children along the cross axis.
• flex-start: align to start
• flex-end: align to end
• center: center items
• stretch: stretch to fill
• baseline: align text baselines`,options:["flex-start","flex-end","center","stretch","baseline"]},{key:"alignContent",type:"select",label:"alignContent",desc:`Align wrapped lines (only with flexWrap).
• flex-start: pack lines at start
• flex-end: pack lines at end
• center: center lines
• stretch: stretch lines to fill
• space-between: equal space between lines
• space-around: equal space around lines`,options:["flex-start","flex-end","center","stretch","space-between","space-around"]},{key:"gap",type:"number",label:"gap",desc:`Space between all children in pixels.
Examples: 0, 10, 20`},{key:"rowGap",type:"number",label:"rowGap",desc:`Space between rows in pixels (overrides gap for rows).
Examples: 0, 10, 20`},{key:"columnGap",type:"number",label:"columnGap",desc:`Space between columns in pixels (overrides gap for columns).
Examples: 0, 10, 20`}]},{title:"Flexbox Item",properties:[{key:"flex",type:"number",label:"flex",desc:`Shorthand for flex-grow. How much this item grows relative to siblings.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexGrow",type:"number",label:"flexGrow",desc:`How much this item grows to fill extra space.
Examples: 0 (don't grow), 1 (grow equally), 2 (grow 2x)`},{key:"flexShrink",type:"number",label:"flexShrink",desc:`How much this item shrinks when space is tight.
Examples: 0 (don't shrink), 1 (shrink equally)`},{key:"flexBasis",type:"number",label:"flexBasis",desc:`Initial size before growing/shrinking, in pixels.
Examples: 0, 100, 200`},{key:"alignSelf",type:"select",label:"alignSelf",desc:`Override parent's alignItems for this item.
• auto: use parent's alignItems
• flex-start/end/center/stretch/baseline: same as alignItems`,options:["auto","flex-start","flex-end","center","stretch","baseline"]}]},{title:"Spacing",properties:[{key:"padding",type:"number",label:"padding",desc:`Inner spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"paddingTop",type:"number",label:"paddingTop",desc:`Inner spacing at top in pixels.
Examples: 0, 10, 20`},{key:"paddingRight",type:"number",label:"paddingRight",desc:`Inner spacing at right in pixels.
Examples: 0, 10, 20`},{key:"paddingBottom",type:"number",label:"paddingBottom",desc:`Inner spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"paddingLeft",type:"number",label:"paddingLeft",desc:`Inner spacing at left in pixels.
Examples: 0, 10, 20`},{key:"margin",type:"number",label:"margin",desc:`Outer spacing on all sides in pixels.
Examples: 0, 10, 20`},{key:"marginTop",type:"number",label:"marginTop",desc:`Outer spacing at top in pixels.
Examples: 0, 10, 20`},{key:"marginRight",type:"number",label:"marginRight",desc:`Outer spacing at right in pixels.
Examples: 0, 10, 20`},{key:"marginBottom",type:"number",label:"marginBottom",desc:`Outer spacing at bottom in pixels.
Examples: 0, 10, 20`},{key:"marginLeft",type:"number",label:"marginLeft",desc:`Outer spacing at left in pixels.
Examples: 0, 10, 20`}]}],X="layout-editor-sessions",U="layout-editor-current-session";class de{constructor(e,t){m(this,"_formContainer");m(this,"_noSelectionEl");m(this,"_selectedNode",null);m(this,"_liveOriginals",new Map);m(this,"_sessionChanges",new Map);m(this,"_hasUnsavedChanges",!1);m(this,"_onChange",null);m(this,"_onCopy",null);m(this,"_onChangesUpdated",null);m(this,"_onReset",null);this._formContainer=document.getElementById(e),this._noSelectionEl=document.getElementById(t),localStorage.removeItem("layout-editor-changes"),localStorage.removeItem("layout-editor-originals"),localStorage.removeItem("layout-editor-transforms")}captureOriginals(e){this._liveOriginals.clear();const t=s=>{this._liveOriginals.set(s.id,{layout:s.layout?{...s.layout}:{},transform:s.transform?{...s.transform}:{}}),s.children.forEach(t)};e.forEach(t),console.log(`[PropertyPanel] Captured originals for ${this._liveOriginals.size} nodes`)}clearOriginals(){this._liveOriginals.clear()}getOriginalValue(e,t,s){const a=this._liveOriginals.get(e);if(a)return s?a.transform[t]:a.layout[t]}getSessionChanges(){return this._sessionChanges}hasUnsavedChanges(){return this._hasUnsavedChanges}hasOriginals(){return this._liveOriginals.size>0}clearCurrentSession(){localStorage.removeItem(U)}getSessions(){try{const e=localStorage.getItem(X);return e?JSON.parse(e):[]}catch{return[]}}saveSession(e){try{const t={};for(const[o,r]of this._sessionChanges){const h={},i=this._liveOriginals.get(o);for(const[f,C]of Object.entries(r)){const w=j(f),P=i?w?i.transform[f]:i.layout[f]:void 0;C!==P&&(h[f]=C)}Object.keys(h).length>0&&(t[o]=h)}const s={changes:t};localStorage.setItem(`layout-editor-session-${e}`,JSON.stringify(s));const a=this.getSessions();a.includes(e)||(a.push(e),localStorage.setItem(X,JSON.stringify(a))),localStorage.setItem(U,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Saved session: ${e} (${Object.keys(t).length} nodes)`)}catch(t){console.warn("[PropertyPanel] Failed to save session:",t)}}loadSession(e){var t;try{const s=localStorage.getItem(`layout-editor-session-${e}`);if(!s)return null;const a=JSON.parse(s);this._sessionChanges.clear();let o=0;for(const[r,h]of Object.entries(a.changes)){const i={},f=this._liveOriginals.get(r);for(const[C,w]of Object.entries(h)){const P=j(C),$=f?P?f.transform[C]:f.layout[C]:void 0;w!==$?i[C]=w:o++}Object.keys(i).length>0&&this._sessionChanges.set(r,i)}return localStorage.setItem(U,e),this._hasUnsavedChanges=!1,console.log(`[PropertyPanel] Loaded session: ${e} (skipped ${o} matching values)`),(t=this._onChangesUpdated)==null||t.call(this),this.render(),{changes:this._sessionChanges,skipped:o}}catch(s){return console.warn("[PropertyPanel] Failed to load session:",s),null}}deleteSession(e){try{localStorage.removeItem(`layout-editor-session-${e}`);const t=this.getSessions().filter(s=>s!==e);localStorage.setItem(X,JSON.stringify(t)),console.log(`[PropertyPanel] Deleted session: ${e}`)}catch(t){console.warn("[PropertyPanel] Failed to delete session:",t)}}getCurrentSessionName(){return localStorage.getItem(U)}onChange(e){this._onChange=e}onCopy(e){this._onCopy=e}onChangesUpdated(e){this._onChangesUpdated=e}onReset(e){this._onReset=e}resetNode(e){var o,r;const t=this._liveOriginals.get(e);if(!t)return;const s=this._sessionChanges.get(e);if(!s)return;const a={};for(const h of Object.keys(s)){const i=j(h);a[h]=i?t.transform[h]:t.layout[h]}this._sessionChanges.delete(e),this._hasUnsavedChanges=!0,(o=this._onReset)==null||o.call(this,e,a),(r=this._onChangesUpdated)==null||r.call(this),this.render()}getChangedNodeIds(){return new Set(this._sessionChanges.keys())}setSelectedNode(e){this._selectedNode=e,this.render()}updateNodeLayout(e,t,s,a){var o;if(((o=this._selectedNode)==null?void 0:o.id)===e&&(this._selectedNode.layout=t,s&&(this._selectedNode.transform=s),a!==void 0)){const r=this._selectedNode.layoutEnabled!==a;this._selectedNode.layoutEnabled=a,r&&this.render()}}render(){var w,P,$;if(!this._selectedNode){this._formContainer.style.display="none",this._noSelectionEl.style.display="block";return}this._noSelectionEl.style.display="none",this._formContainer.style.display="block",this._formContainer.innerHTML="";const e=document.createElement("div");e.id="selected-name-row";const t=document.createElement("div");if(t.id="selected-name",t.textContent=this._selectedNode.id,e.appendChild(t),this._sessionChanges.has(this._selectedNode.id)){const u=document.createElement("button");u.id="reset-node-btn",u.textContent="Reset",u.title="Reset all changes for this node",u.addEventListener("click",()=>{this.resetNode(this._selectedNode.id)}),e.appendChild(u)}this._formContainer.appendChild(e);const s=document.createElement("div");s.className="property-row toggle-row";const a=document.createElement("label");a.textContent="Layout Enabled";const o=document.createElement("input");o.type="checkbox",o.checked=this._selectedNode.layoutEnabled,o.addEventListener("change",()=>{var H,d,k,I,l,L;const u=this._selectedNode.id,N=o.checked;if((H=this._onChange)==null||H.call(this,u,"_layoutEnabled",N),!N){const g=this._liveOriginals.get(u);if(g!=null&&g.transform){const R=["x","y","scaleX","scaleY","rotation","pivotX","pivotY","alpha"];for(const v of R){const O=g.transform[v];O!==void 0&&((d=this._onChange)==null||d.call(this,u,v,O))}(I=(k=this._selectedNode)==null?void 0:k.transform)!=null&&I.hasAnchor&&(g.transform.anchorX!==void 0&&((l=this._onChange)==null||l.call(this,u,"anchorX",g.transform.anchorX)),g.transform.anchorY!==void 0&&((L=this._onChange)==null||L.call(this,u,"anchorY",g.transform.anchorY)))}}}),s.appendChild(a),s.appendChild(o),this._formContainer.appendChild(s);const r=this._liveOriginals.get(this._selectedNode.id),h=(r==null?void 0:r.layout)||{},i=(r==null?void 0:r.transform)||{},f=this._sessionChanges.get(this._selectedNode.id)||{};for(const u of ce){const N=document.createElement("div");N.className="property-section";const H=document.createElement("div");H.className="property-section-title",H.textContent=u.title,N.appendChild(H);for(const d of u.properties){if((d.key==="anchorX"||d.key==="anchorY")&&!((w=this._selectedNode.transform)!=null&&w.hasAnchor))continue;const k=document.createElement("div");k.className="property-row";const I=document.createElement("label");I.className="property-label",I.textContent=d.label,I.title=d.desc;let l;if(d.type==="select"){l=document.createElement("select"),l.className="property-input";const p=document.createElement("option");p.value="",p.textContent="(not set)",l.appendChild(p),d.options.forEach(x=>{const E=document.createElement("option");E.value=x,E.textContent=x,l.appendChild(E)})}else l=document.createElement("input"),l.className="property-input",l.type=d.type==="number"?"number":"text",d.step!==void 0&&(l.step=String(d.step));let L,g;const R=f[d.key];if(u.isTransform){const p=d.key;L=R!==void 0?R:(P=this._selectedNode.transform)==null?void 0:P[p],g=i[d.key]}else L=R!==void 0?R:($=this._selectedNode.layout)==null?void 0:$[d.key],g=h[d.key];L!==void 0&&(l.value=String(L),l.classList.add("has-value")),l instanceof HTMLInputElement&&(l.placeholder="(not set)");const v=document.createElement("span");v.className="property-original";const O=()=>{const p=l.value===""?void 0:l.value,x=g!==void 0?String(g):void 0,E=p!==x;E&&g!==void 0?(v.textContent=`was: ${g}`,v.style.display="inline",v.title="Click to reset"):E&&g===void 0?(v.textContent="new",v.style.display="inline",v.title="Click to clear"):v.style.display="none"};O(),v.setAttribute("role","button"),v.setAttribute("tabindex","0"),v.addEventListener("click",()=>{var p;g!==void 0?l.value=String(g):l.value="",l.classList.toggle("has-value",l.value!==""),O(),(p=this._onChange)==null||p.call(this,this._selectedNode.id,d.key,g)}),v.addEventListener("keydown",p=>{var x;(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),g!==void 0?l.value=String(g):l.value="",l.classList.toggle("has-value",l.value!==""),O(),(x=this._onChange)==null||x.call(this,this._selectedNode.id,d.key,g))}),l.addEventListener("change",()=>{var G,J;l.classList.toggle("has-value",l.value!==""),O();let p=l.value;d.type==="number"&&p!==""&&(p=parseFloat(p)),p===""&&!u.isTransform&&(p=void 0);const x=this._selectedNode.id;this._sessionChanges.has(x)||this._sessionChanges.set(x,{});const E=this._sessionChanges.get(x),se=u.isTransform?i[d.key]:h[d.key];p!==se?(E[d.key]=p,this._hasUnsavedChanges=!0):(delete E[d.key],Object.keys(E).length===0&&this._sessionChanges.delete(x)),(G=this._onChangesUpdated)==null||G.call(this),(J=this._onChange)==null||J.call(this,this._selectedNode.id,d.key,p)}),k.appendChild(I),k.appendChild(l),k.appendChild(v),N.appendChild(k)}this._formContainer.appendChild(N)}const C=document.createElement("button");C.id="copy-btn",C.textContent="Copy Layout",C.addEventListener("click",()=>{var u;(u=this._onCopy)==null||u.call(this,this._selectedNode.id)}),this._formContainer.appendChild(C)}}const M=document.getElementById("connection-dropdown"),A=document.getElementById("connection-dropdown-btn"),V=document.getElementById("connection-dropdown-menu"),D=document.getElementById("session-dropdown"),B=document.getElementById("session-dropdown-btn"),K=document.getElementById("session-list"),pe=document.getElementById("session-create"),F=document.getElementById("save-session-btn"),he=document.getElementById("autosave-label"),T=document.getElementById("autosave-checkbox"),Q=document.getElementById("view-changes-btn"),_=document.getElementById("changes-modal"),z=document.getElementById("changes-list"),ge=document.getElementById("close-modal-btn"),me=document.getElementById("reset-all-btn");let y=null,q=!1;const Z="layout-editor-autosave";T.checked=localStorage.getItem(Z)==="true";const W=()=>{F.disabled=!b.isConnected||T.checked};T.addEventListener("change",()=>{localStorage.setItem(Z,String(T.checked)),W()});W();const S=new le("tree-view"),c=new de("property-form","no-selection"),ee=n=>{if(n.size>0){console.log(`[Layout Editor] Applying ${n.size} node changes...`);for(const[e,t]of n)for(const[s,a]of Object.entries(t))b.send({type:"set-property",id:e,property:s,value:a})}},te=n=>{D.style.display=n?"block":"none",F.style.display=n?"inline-block":"none",he.style.display=n?"flex":"none",Q.style.display=n?"inline-block":"none",n&&W()};S.onSelect(n=>{c.setSelectedNode(n),b.send({type:"highlight",id:(n==null?void 0:n.id)||null})});S.onHover(n=>{const e=n??S.getSelectedId();b.send({type:"highlight",id:e})});c.onChange((n,e,t)=>{b.send({type:"set-property",id:n,property:e,value:t}),T.checked&&y&&c.saveSession(y)});c.onChangesUpdated(()=>{S.setChangedNodes(c.getChangedNodeIds())});c.onCopy(n=>{b.send({type:"get-layout",id:n})});c.onReset((n,e)=>{for(const[t,s]of Object.entries(e))b.send({type:"set-property",id:n,property:t,value:s})});const ue=()=>{z.innerHTML="";const n=c.getSessionChanges();if(n.size===0){z.innerHTML='<p style="color: #808080;">No changes</p>';return}for(const[e,t]of n){const s=document.createElement("div");s.className="change-node";const a=document.createElement("div");a.className="change-node-header",a.textContent=e,a.addEventListener("click",()=>{const o=S.getNodeById(e);o&&(c.setSelectedNode(o),S.selectNodeById(e)),_.style.display="none"}),s.appendChild(a);for(const[o,r]of Object.entries(t)){const h=j(o),i=c.getOriginalValue(e,o,h),f=document.createElement("div");f.className="change-item",f.innerHTML=`
        <span class="change-prop">${o}:</span>
        <span class="change-old">${i??"(not set)"}</span>
        <span class="change-arrow">→</span>
        <span class="change-new">${r??"(not set)"}</span>
      `,s.appendChild(f)}z.appendChild(s)}};Q.addEventListener("click",()=>{ue(),_.style.display="flex"});ge.addEventListener("click",()=>{_.style.display="none"});_.addEventListener("click",n=>{n.target===_&&(_.style.display="none")});document.addEventListener("keydown",n=>{n.key==="Escape"&&_.style.display!=="none"&&(_.style.display="none")});me.addEventListener("click",()=>{if(confirm("Reset all changes?")){const n=c.getSessionChanges();for(const[e]of n)c.resetNode(e);_.style.display="none"}});const ne=n=>{if(A.textContent=n?"Connected":"Disconnected",A.classList.toggle("connected",n),A.classList.toggle("disconnected",!n),V.innerHTML="",n){const e=document.createElement("div");e.className="dropdown-item",e.textContent="Refresh",e.addEventListener("click",()=>{b.send({type:"get-hierarchy"}),M.classList.remove("open")});const t=document.createElement("div");t.className="dropdown-item",t.textContent="Disconnect",t.addEventListener("click",()=>{b.disconnect(),M.classList.remove("open")}),V.appendChild(e),V.appendChild(t)}else{const e=document.createElement("div");e.className="dropdown-item",e.textContent="Connect",e.addEventListener("click",()=>{b.connect(),M.classList.remove("open")}),V.appendChild(e)}};b.onStatusChange(n=>{ne(n),te(n),n||(q=!1,c.clearOriginals())});A.addEventListener("click",()=>{M.classList.toggle("open")});ne(!1);b.on("hierarchy",n=>{const e=n.data;if(!q){c.captureOriginals(e),q=!0;const t=c.getCurrentSessionName();if(t){const s=c.loadSession(t);s&&s.changes.size>0&&(y=t,B.textContent=t,ee(s.changes))}}S.setHierarchy(e),S.setChangedNodes(c.getChangedNodeIds())});b.on("updated",n=>{c.updateNodeLayout(n.id,n.layout,n.transform,n.layoutEnabled),n.layoutEnabled!==void 0&&S.updateNode(n.id,{layout:n.layout,layoutEnabled:n.layoutEnabled})});b.on("layout-config",n=>{const e=JSON.stringify(n.config,null,2);navigator.clipboard.writeText(e).then(()=>{alert("Layout copied to clipboard!")})});const Y=()=>{const n=c.getSessions();K.innerHTML="",n.forEach(e=>{const t=document.createElement("div");t.className="dropdown-item",e===y&&t.classList.add("selected");const s=document.createElement("span");s.className="session-name",s.textContent=e;const a=document.createElement("button");a.className="delete-btn",a.textContent="✕",a.addEventListener("click",o=>{o.stopPropagation(),confirm(`Delete session "${e}"?`)&&(c.deleteSession(e),y===e&&(y=null,B.textContent="Select Session"),Y())}),t.appendChild(s),t.appendChild(a),t.addEventListener("click",async()=>{c.hasUnsavedChanges()&&!T.checked&&y?confirm(`Save changes to "${y}" before switching?`)&&c.saveSession(y):T.checked&&y&&c.saveSession(y);const o=c.loadSession(e);o&&(y=e,B.textContent=e,D.classList.remove("open"),ee(o.changes),Y())}),K.appendChild(t)})};B.addEventListener("click",()=>{B.disabled||D.classList.toggle("open")});document.addEventListener("click",n=>{D.contains(n.target)||D.classList.remove("open"),M.contains(n.target)||M.classList.remove("open")});pe.addEventListener("click",()=>{const n=prompt("New session name:");n&&n.trim()&&(c.saveSession(n.trim()),y=n.trim(),B.textContent=n.trim(),D.classList.remove("open"),Y())});F.addEventListener("click",()=>{if(y)c.saveSession(y),console.log(`[Layout Editor] Saved to session: ${y}`);else{const n=prompt("No session loaded. Create new session:");n&&n.trim()&&(c.saveSession(n.trim()),y=n.trim(),B.textContent=n.trim(),Y())}});te(!1);Y();console.log("Layout Editor loaded");
